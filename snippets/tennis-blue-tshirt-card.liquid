{% comment %}
  Section: Tennis Blue T‑Shirt Card
  Modal-friendly product detail card with editable settings, designed to be fetched into a modal.
{% endcomment %}

{%- assign close_icon_url = section.settings.close_icon != blank 
  ? section.settings.close_icon | image_url: width: 22 
  : 'img_group_1000008134.svg' | asset_url -%}

{%- assign dropdown_arrow_url = section.settings.dropdown_arrow != blank 
  ? section.settings.dropdown_arrow | image_url: width: 24 
  : 'img_arrow_down.svg' | asset_url -%}

{%- assign cart_arrow_url = section.settings.cart_arrow != blank 
  ? section.settings.cart_arrow | image_url: width: 48 
  : 'img_line_15_white_a700.svg' | asset_url -%}

{%- assign product_image_url = section.settings.product_image != blank 
  ? section.settings.product_image | image_url: width: 800 
  : 'img_image_826.png' | asset_url -%}

<style>
  /* Scoped namespace: tbt- (Tennis Blue T‑Shirt) */
  .tbt-container { background:#fff; box-shadow:0 2px 4px #00000033; width:100%; max-width:400px; margin:0 auto; padding:12px 16px 24px 16px; font-family:'Jost', Arial, sans-serif; }
  .tbt-content { display:flex; flex-direction:column; align-items:center; width:100%; }
  .tbt-header { display:flex; flex-direction:column; align-items:center; width:100%; margin-bottom:16px; }
  .tbt-image { width:45%; height:159px; object-fit:cover; margin-bottom:-2px; margin-right:16px; }
  .tbt-info { display:flex; flex-direction:column; align-items:flex-start; flex:1; gap:16px; width:100%; }
  .tbt-close { width:16px; height:11px; align-self:flex-end; margin-bottom:16px; cursor:pointer; }

  .tbt-details { display:flex; flex-direction:column; align-items:flex-start; width:100%; gap:10px; }
  .tbt-title { font-size:14px; font-weight:300; line-height:18px; color:#000; }
  .tbt-price { font-size:14px; font-family:'Lustria', serif; font-weight:400; line-height:16px; color:#000; }
  .tbt-desc  { font-size:12px; font-weight:300; line-height:14px; color:#000; width:100%; }

  .tbt-color { display:flex; flex-direction:column; align-items:flex-start; width:100%; max-width:272px; gap:2px; margin-top:16px; }
  .tbt-label { font-size:12px; font-weight:400; line-height:16px; color:#333; }
  .tbt-color-row { display:flex; align-items:center; width:100%; border:1px solid #000; }
  .tbt-color-opt { padding-right:79px; display:flex; align-items:center; cursor:pointer; transition:all .3s ease; }
  .tbt-color-opt:hover { opacity:.8; }
  .tbt-swatch { width:7px; height:32px; border:1px solid #000; }
  .tbt-swatch--primary { background-color: {{ section.settings.color_primary | default: '#AFAFB7' }} !important; border-color: {{ section.settings.color_primary | default: '#AFAFB7' }} !important; }
  .tbt-swatch--secondary { background-color: {{ section.settings.color_secondary | default: '#000000' }} !important; border-color:#000 !important; }
  .tbt-color-text { font-size:16px; font-weight:400; line-height:20px; color:#000; margin-left:8px; text-transform:capitalize; }
  .tbt-color-opt.selected { background:#000; }
  .tbt-color-opt.selected .tbt-color-text { color:#fff; }

  .tbt-size { display:flex; flex-direction:column; align-items:flex-start; width:100%; max-width:272px; gap:2px; margin-top:8px; }
  .tbt-sizebar { position:relative; width:100%; border:1px solid #000; display:flex; align-items:center; cursor:pointer; user-select:none; }
  .tbt-size-text { padding-left:3%; font-size:14px; font-weight:400; line-height:18px; color:#000; margin:8px 0; flex:1; }
  .tbt-size-ctrl { display:inline-flex; align-items:center; gap:8px; pointer-events:none; padding:0 8px; }
  .tbt-size-line { width:1px; height:30px; background:#000; }
  .tbt-arrow { width:12px; height:6px; transition:transform .25s; }

  .tbt-menu { position:absolute; top:110%; left:0; right:0; max-height:96px; overflow-y:auto; border:1px solid #000; background:#fff; box-shadow:0 6px 12px #0002; margin:6px 0 0; padding:0; list-style:none; display:none; z-index:1000; scrollbar-width:none; -ms-overflow-style:none; }
  .tbt-menu::-webkit-scrollbar { display:none; }
  .tbt-menu.show { display:block; }
  .tbt-opt { padding:8px 12px; font-family:'Jost', Arial, sans-serif; font-size:14px; line-height:18px; border-bottom:1px solid #eee; cursor:pointer; }
  .tbt-opt:last-child { border-bottom:none; }
  .tbt-opt:hover, .tbt-opt.selected { background:#000; color:#fff; }

  .tbt-cta { display:flex; justify-content:flex-end; align-items:center; width:100%; max-width:272px; background:#000; padding:8px 30px; margin-top:40px; cursor:pointer; transition:all .3s ease; border:0; }
  .tbt-cta:hover { background:#333; transform:translateY(-2px); }
  .tbt-cta:active { transform:translateY(0); background:#555; }
  .tbt-cta-text { font-size:14px; font-weight:400; line-height:18px; text-transform:uppercase; color:#fff; }
  .tbt-cta-arrow { width:32px; height:1px; margin-left:28px; }

  @media (min-width:640px) {
    .tbt-header { flex-direction:row; align-items:end; }
    .tbt-image { height:159px; width:45%; object-fit:cover; margin-bottom:-2px; margin-right:16px; }
    .tbt-price { font-size:17px; }
    .tbt-container { max-width:282px; }
    .tbt-desc { font-size:14px; font-weight:200; }
    .tbt-color { margin-top:-7px; }
  }

  @media (min-width:768px) {
    .tbt-title { font-size:16px; line-height:24px; }
    .tbt-price { font-size:16px; line-height:21px; }
    .tbt-desc { font-size:13px; line-height:15px; }
    .tbt-image { height:184px; margin-left:8px; }
    .tbt-cta { margin-top:50px; }
    .tbt-color-opt { padding-right:90px; }
    .tbt-cta-text { font-size:16px; line-height:24px; }
    .tbt-swatch { height:40px; }
    .tbt-size-text { font-size:16px; line-height:24px; padding-left:4%; }
    .tbt-size-line { height:38px; }
  }

  @media (min-width:1024px) {
    .tbt-color-opt { padding-right:100px; }
    .tbt-container { max-width:350px; padding:20px 32px 40px 32px; }
    .tbt-desc { font-size:12px !important; }
    .tbt-image { height:152px !important; margin-left:5px !important; }
  }

  @media (min-width:0px) and (max-width:639px) {
    .tbt-header { flex-direction:row; }
    .tbt-details { padding-top:31px; }
    .tbt-container { max-width:330px !important; position:relative; }
    .tbt-image { width:123px !important; height:122px !important; margin-bottom:-34px !important; padding-left:10px !important; }
    .tbt-info { padding-left:7px !important; }
    .tbt-desc { font-size:13px !important; }
    .tbt-color { margin-top:0 !important; }
    .tbt-close { position:absolute; top:10px; right:10px; z-index:10; }
  }
</style>

<div class="tbt-container">
  <div class="tbt-content">
    <div class="tbt-header">
      <img src="{{ product_image_url }}" alt="{{ section.settings.product_image.alt | escape | default: 'Product image' }}" class="tbt-image" />
      <div class="tbt-info">
        <!-- Keep .close-button for the landing modal script -->
        <img src="{{ close_icon_url }}" alt="Close" class="tbt-close close-button" />
        <div class="tbt-details">
          <h1 class="tbt-title">{{ section.settings.title | default: 'Tennis Blue T‑Shirt' }}</h1>
          <p class="tbt-price">{{ section.settings.price | default: '980,00€' }}</p>
          <p class="tbt-desc">{{ section.settings.description | default: 'This one-piece swimsuit is crafted from jersey featuring an allover micro Monogram motif in relief.' }}</p>
        </div>
      </div>
    </div>

    <div class="tbt-color">
      <label class="tbt-label">{{ section.settings.color_label | default: 'Color' }}</label>
      <div class="tbt-color-row">
        <div class="tbt-color-opt">
          <div class="tbt-swatch tbt-swatch--primary"></div>
          <span class="tbt-color-text">{{ section.settings.color_primary_label | default: 'Grey' }}</span>
        </div>
        <div class="tbt-color-opt" style="flex:1;">
          <div class="tbt-swatch tbt-swatch--secondary"></div>
          <span class="tbt-color-text">{{ section.settings.color_secondary_label | default: 'Black' }}</span>
        </div>
      </div>
    </div>

    <div class="tbt-size">
      <label class="tbt-label">{{ section.settings.size_label | default: 'Size' }}</label>
      <div class="tbt-sizebar" id="tbtSizeBar" tabindex="0" aria-haspopup="listbox" aria-expanded="false">
        <span class="tbt-size-text" id="tbtSizeText">{{ section.settings.size_prompt | default: 'Choose your size' }}</span>
        <div class="tbt-size-ctrl">
          <div class="tbt-size-line"></div>
          <img src="{{ dropdown_arrow_url }}" alt="toggle" class="tbt-arrow" id="tbtArrow">
        </div>
        <ul class="tbt-menu" id="tbtMenu" role="listbox" aria-label="Size options">
          {%- assign size_list = section.settings.sizes | default: 'XS,S,M,L,XL' | split: ',' -%}
          {%- for s in size_list -%}
            {%- assign s_trim = s | strip -%}
            <li class="tbt-opt" role="option" aria-selected="false">{{ s_trim }}</li>
          {%- endfor -%}
        </ul>
      </div>
    </div>

    <button class="tbt-cta" type="button" id="tbtAddToCart">
      <span class="tbt-cta-text">{{ section.settings.cta_label | default: 'Add to cart' }}</span>
      <img src="{{ cart_arrow_url }}" alt="Arrow" class="tbt-cta-arrow" />
    </button>
  </div>
</div>

<script>
  (function() {
    // Size dropdown behavior
    var bar = document.getElementById('tbtSizeBar');
    var menu = document.getElementById('tbtMenu');
    var label = document.getElementById('tbtSizeText');
    var arrow = document.getElementById('tbtArrow');
    var open = false;

    function openMenu() { open = true; menu.classList.add('show'); arrow.style.transform = 'rotate(180deg)'; bar.setAttribute('aria-expanded', 'true'); }
    function closeMenu() { open = false; menu.classList.remove('show'); arrow.style.transform = 'rotate(0deg)'; bar.setAttribute('aria-expanded', 'false'); }
    function toggleMenu() { open ? closeMenu() : openMenu(); }

    if (bar) {
      bar.addEventListener('click', function(e){ e.stopPropagation(); toggleMenu(); });
      window.addEventListener('click', function(){ if (open) closeMenu(); });
      window.addEventListener('keydown', function(e){
        if (e.key === 'Escape' && open) closeMenu();
        if ((e.key === 'Enter' || e.key === ' ') && document.activeElement === bar) { e.preventDefault(); toggleMenu(); }
      });
    }

    if (menu) {
      menu.querySelectorAll('.tbt-opt').forEach(function(opt){
        opt.addEventListener('click', function(e){
          e.stopPropagation();
          label.textContent = opt.textContent;
          menu.querySelectorAll('.tbt-opt').forEach(function(o){ o.classList.remove('selected'); o.setAttribute('aria-selected','false'); });
          opt.classList.add('selected');
          opt.setAttribute('aria-selected','true');
          closeMenu();
        });
      });
    }

    // Color selection
    var colorOpts = document.querySelectorAll('.tbt-color-opt');
    colorOpts.forEach(function(opt){
      opt.addEventListener('click', function(){
        colorOpts.forEach(function(o){ o.classList.remove('selected'); });
        opt.classList.add('selected');
      });
    });

    // Add to cart placeholder: emit event for host page handler
    var addBtn = document.getElementById('tbtAddToCart');
    if (addBtn) {
      addBtn.addEventListener('click', function(){
        var evt = new CustomEvent('tbt:add-to-cart', {
          detail: {
            title: '{{ section.settings.title | escape }}',
            price: '{{ section.settings.price | escape }}',
            size: label ? label.textContent : null
          }
        });
        window.dispatchEvent(evt);
      });
    }
  })();
</script>

{% schema %}
{
  "name": "Tennis Blue T‑Shirt Card",
  "settings": [
    { "type": "image_picker", "id": "product_image", "label": "Product image" },
    { "type": "text", "id": "title", "label": "Title", "default": "Tennis Blue T‑Shirt" },
    { "type": "text", "id": "price", "label": "Price", "default": "980,00€" },
    { "type": "textarea", "id": "description", "label": "Description", "default": "This one-piece swimsuit is crafted from jersey featuring an allover micro Monogram motif in relief." },

    { "type": "image_picker", "id": "close_icon", "label": "Close icon" },
    { "type": "image_picker", "id": "dropdown_arrow", "label": "Dropdown arrow icon" },
    { "type": "image_picker", "id": "cart_arrow", "label": "Cart arrow icon" },

    { "type": "text", "id": "color_label", "label": "Color label", "default": "Color" },
    { "type": "text", "id": "color_primary_label", "label": "Primary color label", "default": "Grey" },
    { "type": "color", "id": "color_primary", "label": "Primary color swatch", "default": "#AFAFB7" },
    { "type": "text", "id": "color_secondary_label", "label": "Secondary color label", "default": "Black" },
    { "type": "color", "id": "color_secondary", "label": "Secondary color swatch", "default": "#000000" },

    { "type": "text", "id": "size_label", "label": "Size label", "default": "Size" },
    { "type": "text", "id": "size_prompt", "label": "Size prompt", "default": "Choose your size" },
    { "type": "text", "id": "sizes", "label": "Sizes (comma-separated)", "default": "XS,S,M,L,XL" },

    { "type": "text", "id": "cta_label", "label": "Button text", "default": "Add to cart" }
  ],
  "blocks": [],
  "presets": [
    { "name": "Tennis Blue T‑Shirt Card" }
  ]
}
{% endschema %}
